<!DOCTYPE html>
<html>

<head>
  <title>Group 1 Project: Destination Alarm Clock: Leaflet Control Geocoder</title>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, maximum-scale=1" />

  <!-- Bootstrap Library CSS CDN go here -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />


  <!-- Boostrap Library JS CDN  go here and JQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous">
  </script>

  <!-- Leaflet API -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.2/dist/leaflet.css"
    integrity="sha256-sA+zWATbFveLLNqWO2gtiw3HL/lh1giY/Inf1BJ0z14=" crossorigin="" />
  <!-- Make sure you put this AFTER Leaflet's CSS -->
  <script src="https://unpkg.com/leaflet@1.9.2/dist/leaflet.js"
    integrity="sha256-o9N1jGDZrf5tS+Ft4gbIK7mYMipq9lqpVJ91xHSyKhg=" crossorigin=""></script>

  <style type="text/css">
    body {
      margin: 0;
    }

    #map {
      width: 700px;
      height: 700px;
    }
  </style>
</head>

<body>

  <!--JUMBOTRON-->
  <div class="jumbotron jumbotron-fluid">
    <div class="container">
      <h1 class="display-4">Destination Alarm Clock</h1>
      <p class="lead">Pick a location and set an alarm!</p>
      <div class="search-scope">
        <input type="range" min="100" max="1000" value="500" class="slider" id="myRange">
        <p>Radius (meters) :
          <span id="radius-goes-here">500</span>
        </p>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="click-to-map">
      <h1>Click anywhere on the map to navigate</h1>
    </div>
    <div id="message"></div>
    <div id="map"></div>
  </div>

  <!--SCRIPT -->
  <script type="text/javascript">
    //----------------------------
    // Get radius from the slider
    //----------------------------
    var myradius = document.getElementById("myRange").value;
    document.getElementById("myRange").addEventListener("click", function () {
      myradius = document.getElementById("myRange").value;
      console.log(myradius);
      document.getElementById("radius-goes-here").innerHTML = myradius;
    })

    //--------------------------------------
    // MAP:  get current geolocation
    //---------------------------------------
    navigator.geolocation.getCurrentPosition(onSuccess, onError);
    var map; //for the map to be displayed
    var marker; //for current location
    var circle; //for destination location

    //------------------------
    // handle success case
    //------------------------
    function onSuccess(position) { //callback function
      const {
        latitude,
        longitude
      } = position.coords;

      //print helpful messages about current location
      message.classList.add('success');
      message.textContent = `Your location: (${latitude},${longitude})`;
      //set map to be around current location
      //set a marker at the current location
      map = L.map('map').setView([latitude, longitude], 13);
      marker = L.marker([latitude, longitude]).addTo(map);
      // map = L.map('map').setView([49.251793, -123.017628], 13);
      // marker = L.marker([49.251793, -123.017628]).addTo(map);

      //put overlay on the map, give credit wher credit is due
      L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      }).addTo(map);

      //create a popup when a location is clicked
      //create a circle marker when a location is clicked
      var popup = L.popup();
      var location = new L.circle();

      //Create listener, and event handler for a click
      //"e" is the clicked location
      map.on('click', onMapClick);
      function onMapClick(e) {
        //assign content to popup message
        popup
          .setLatLng(e.latlng)
          .setContent("You clicked the map at " + e.latlng.toString())
          .openOn(map);
        //remove old layers with circlemarker
        //create new circle around clicked location "e"
        //add it to the  map
        map.removeLayer(location);
        console.log(myradius);
        location = new L.circle(e.latlng, {
          fillColor: '#f03',
          radius: myradius,
        });
        map.addLayer(location);
      }
    }

    // handle error case
    function onError() {
      message.classList.add('error');
      message.textContent = `Failed to get your location!`;
    }
  </script>
</body>

</html>